name: åˆéšä»»å‹™é©—è­‰

on:
  push:
    branches: ['*']
  pull_request:
    branches: ['*']

jobs:
  validate-missions:
    name: é©—è­‰åˆéšä»»å‹™ 7 é¡Œ
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Task 1 - Check website title
        run: |
          echo "ğŸ“‹ é¡Œç›® 1ï¼šæª¢æŸ¥ç¶²ç«™ Title"
          if grep -q "<title>LiveFit</title>" frontend/index.html; then
            echo "âœ… é€šéï¼šTitle å·²æ”¹ç‚º LiveFit"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ frontend/index.html ä¸­çš„ <title>LiveFit+</title> æ”¹ç‚º <title>LiveFit</title>"
            exit 1
          fi

      - name: Task 2 - Check logo image
        run: |
          echo "ğŸ“‹ é¡Œç›® 2ï¼šæª¢æŸ¥ç¶²ç«™ Logo"
          if grep -q "logo-text-v2.png" frontend/src/layouts/LayoutHeader.vue; then
            echo "âœ… é€šéï¼šLogo å·²æ”¹ç‚º logo-text-v2.png"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ frontend/src/layouts/LayoutHeader.vue ä¸­çš„ logo-text.png æ”¹ç‚º logo-text-v2.png"
            exit 1
          fi

      - name: Task 3 - Check JWT expiration
        run: |
          echo "ğŸ“‹ é¡Œç›® 3ï¼šæª¢æŸ¥ Token éæœŸè¨­å®š"
          if grep -q "JWT_EXPIRES_DAY=7d" .env.example; then
            echo "âœ… é€šéï¼šJWT_EXPIRES_DAY å·²æ”¹ç‚º 7d"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ .env.example ä¸­çš„ JWT_EXPIRES_DAY=30d æ”¹ç‚º JWT_EXPIRES_DAY=7d"
            exit 1
          fi

      - name: Task 4 - Check Entity comment
        run: |
          echo "ğŸ“‹ é¡Œç›® 4ï¼šæª¢æŸ¥ Entity æ¬„ä½èªªæ˜"
          if head -10 backend/entities/CreditPackages.js | grep -q "å ‚æ•¸æ–¹æ¡ˆè³‡æ–™è¡¨"; then
            echo "âœ… é€šéï¼šå·²æ–°å¢æ¬„ä½èªªæ˜è¨»è§£"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹åœ¨ backend/entities/CreditPackages.js æª”æ¡ˆæœ€ä¸Šæ–¹æ–°å¢æ¬„ä½èªªæ˜è¨»è§£"
            exit 1
          fi

      - name: Task 5 - Check password length
        run: |
          echo "ğŸ“‹ é¡Œç›® 5ï¼šæª¢æŸ¥å¯†ç¢¼é•·åº¦é™åˆ¶"
          if grep -q "\.{10,16}" backend/controllers/users.js; then
            echo "âœ… é€šéï¼šå¯†ç¢¼é•·åº¦å·²æ”¹ç‚º 10-16"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ backend/controllers/users.js ä¸­çš„ .{8,16} æ”¹ç‚º .{10,16}"
            exit 1
          fi

      - name: Task 6 - Check API total field
        run: |
          echo "ğŸ“‹ é¡Œç›® 6ï¼šæª¢æŸ¥ API å›å‚³ç¸½ç­†æ•¸"
          if grep -q "total: creditPackage.length" backend/controllers/creditPackage.js; then
            echo "âœ… é€šéï¼šå·²æ–°å¢ total æ¬„ä½"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹åœ¨ backend/controllers/creditPackage.js çš„ getAll å‡½æ•¸ä¸­æ–°å¢ total: creditPackage.length"
            exit 1
          fi

      - name: Task 7 - Check healthcheck response
        run: |
          echo "ğŸ“‹ é¡Œç›® 7ï¼šæª¢æŸ¥å¥åº·æª¢æŸ¥å›å‚³æ ¼å¼"
          if grep -A5 "app.get('/healthcheck'" backend/app.js | grep -q "res.status(200).json"; then
            echo "âœ… é€šéï¼šhealthcheck å·²æ”¹ç‚º JSON æ ¼å¼"
          else
            echo "âŒ å¤±æ•—ï¼šè«‹å°‡ backend/app.js ä¸­çš„ healthcheck è·¯ç”±æ”¹ç‚ºå›å‚³ JSON æ ¼å¼"
            exit 1
          fi

      - name: All missions completed
        run: |
          echo ""
          echo "ğŸ‰ğŸ‰ğŸ‰ æ­å–œï¼åˆéšä»»å‹™å…¨éƒ¨é€šéï¼ğŸ‰ğŸ‰ğŸ‰"
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘           åˆéšä»»å‹™é©—è­‰çµæœ                          â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  é¡Œç›® 1ï¼šä¿®æ”¹ç¶²ç«™ Title              âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 2ï¼šæ›´æ›ç¶²ç«™ Logo               âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 3ï¼šä¿®æ”¹ Token éæœŸè¨­å®š         âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 4ï¼šæ–°å¢ Entity æ¬„ä½èªªæ˜        âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 5ï¼šä¿®æ”¹å¯†ç¢¼é•·åº¦é™åˆ¶            âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 6ï¼šæ–°å¢ API å›å‚³ç¸½ç­†æ•¸         âœ… é€šé        â•‘"
          echo "â•‘  é¡Œç›® 7ï¼šä¿®æ”¹å¥åº·æª¢æŸ¥å›å‚³æ ¼å¼        âœ… é€šé        â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘  âœ… å…¨éƒ¨ 7 é¡Œé€šéï¼                                 â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
